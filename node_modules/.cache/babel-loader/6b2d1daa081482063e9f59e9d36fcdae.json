{"ast":null,"code":"import { ethers } from 'ethers';\nexport var CALLSCRIPT_ID = '0x00000001';\n\nfunction decodeSegment(script) {\n  // Get address\n  var to = \"0x\".concat(script.substring(0, 40));\n  script = script.substring(40); // Get data\n\n  var dataLength = parseInt(\"0x\".concat(script.substring(0, 8)), 16) * 2;\n  script = script.substring(8);\n  var data = \"0x\".concat(script.substring(0, dataLength)); // Return rest of script for processing\n\n  script = script.substring(dataLength);\n  return {\n    segment: {\n      to: to,\n      data: data\n    },\n    scriptLeft: script\n  };\n}\n/**\n * Checks whether a EVMScript bytes string is a call script.\n */\n\n\nexport function isCallScript(script) {\n  // Get script identifier (0x prefix + bytes4)\n  var scriptId = script.substring(0, 10);\n  return scriptId === CALLSCRIPT_ID;\n}\n/**\n * Decode a call script bytes string into its actions.\n *\n * Will return an array containing objects with:\n *\n *  - `to`: to address\n *  - `data`: call data\n *\n */\n\nexport function decodeCallScript(script) {\n  if (!isCallScript(script)) {\n    throw new Error(\"Not a call script: \".concat(script));\n  }\n\n  var scriptData = script.substring(10);\n  var segments = [];\n\n  while (scriptData.length > 0) {\n    var _decodeSegment = decodeSegment(scriptData),\n        segment = _decodeSegment.segment,\n        scriptLeft = _decodeSegment.scriptLeft;\n\n    segments.push(segment);\n    scriptData = scriptLeft;\n  }\n\n  return segments;\n}\n/**\n * Encode a call script\n *\n * Example:\n *\n * input:\n * [\n *  { to: 0xaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa, data: 0x11111111 },\n *  { to: 0xbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb, data: 0x2222222222 }\n * ]\n *\n * output:\n * 0x00000001\n *   aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa0000000411111111\n *   bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb000000052222222222\n *\n *\n * @param {Array<CallScriptAction>} actions\n * @returns {string}\n */\n\nexport function encodeCallScript(actions) {\n  return actions.reduce(function (script, _ref) {\n    var to = _ref.to,\n        data = _ref.data;\n    var address = ethers.utils.defaultAbiCoder.encode(['address'], [to]);\n    var dataLength = ethers.utils.defaultAbiCoder.encode(['uint256'], [(data.length - 2) / 2]);\n    return script + address.slice(26) + dataLength.slice(58) + data.slice(2);\n  }, CALLSCRIPT_ID);\n}","map":null,"metadata":{},"sourceType":"module"}