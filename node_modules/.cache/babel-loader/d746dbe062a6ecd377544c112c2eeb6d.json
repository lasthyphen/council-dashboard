{"ast":null,"code":"import _styled10 from\"styled-components\";import _styled9 from\"styled-components\";import _styled8 from\"styled-components\";import _styled7 from\"styled-components\";import _styled6 from\"styled-components\";import _styled5 from\"styled-components\";import _styled4 from\"styled-components\";import _styled3 from\"styled-components\";import _styled2 from\"styled-components\";import _styled from\"styled-components\";import React,{useMemo}from'react';import{GU,Help,textStyle,useTheme}from'@aragon/ui';import{Phase as DisputePhase,Status as DisputeStatus}from'../../types/dispute-status-types';import DisputeAppeal from'./actions/DisputeAppeal';import DisputeAutoReveal from'./DisputeAutoReveal';import DisputeDraft from'./actions/DisputeDraft';import DisputeExecuteRuling from'./actions/DisputeExecuteRuling';import DisputeReveal from'./actions/DisputeReveal';import DisputeVoting from'./actions/DisputeVoting';import{useWallet}from'../../providers/Wallet';import{getJurorDraft,hasJurorVoted,canJurorReveal}from'../../utils/juror-draft-utils';import{isvoteLeaked,voteOptionToString,OUTCOMES}from'../../utils/crvoting-utils';import{dateFormat}from'../../utils/date-utils';import IconGavelOrange from\"../../assets/IconGavelOrange.svg\";import IconGavelRed from\"../../assets/IconGavelRed.svg\";import{getDisputeLastRound}from'../../utils/dispute-utils';import IconRewardsGreen from\"../../assets/IconRewardsGreen.svg\";function DisputeActions(_ref){var dispute=_ref.dispute,onAutoReveal=_ref.onAutoReveal,onDraft=_ref.onDraft,onExecuteRuling=_ref.onExecuteRuling,onRequestCommit=_ref.onRequestCommit,onRequestReveal=_ref.onRequestReveal,onRequestAppeal=_ref.onRequestAppeal;var phase=dispute.phase,status=dispute.status;var lastRound=getDisputeLastRound(dispute);var wallet=useWallet();if(phase===DisputePhase.Evidence){return null;}if(phase===DisputePhase.JuryDrafting){return React.createElement(DisputeDraft,{disputeId:dispute.id,onDraft:onDraft});}var jurorDraft=getJurorDraft(lastRound,wallet.account);// TODO: Should we also show results for past rounds ?\nvar isJurorDrafted=!!jurorDraft;var jurorHasVoted=isJurorDrafted&&hasJurorVoted(jurorDraft);if(phase===DisputePhase.VotingPeriod&&!jurorHasVoted){return React.createElement(DisputeVoting,{draftTermId:lastRound.draftTermId,isFinalRound:dispute.maxAppealReached,isJurorDrafted:isJurorDrafted,onRequestCommit:onRequestCommit});}return React.createElement(React.Fragment,null,React.createElement(InformationSection,{phase:phase,status:status,jurorDraft:jurorDraft,hasJurorVoted:jurorHasVoted,lastRound:lastRound}),function(){// If connected account not drafted for current dispute\nif(!isJurorDrafted)return null;// If juror has already voted\nif(phase===DisputePhase.VotingPeriod)return React.createElement(DisputeAutoReveal,{disputeId:dispute.id,commitment:jurorDraft.commitment,onAutoReveal:onAutoReveal,roundId:dispute.lastRoundId});// If we are past the voting period && juror hasn't voted\nif(!jurorHasVoted)return null;// If reveal period has already pass\nif(phase!==DisputePhase.RevealVote)return null;// If juror cannot reveal (has already revealed || voted leaked)\nif(!canJurorReveal(jurorDraft))return null;return React.createElement(DisputeReveal,{disputeId:dispute.id,roundId:dispute.lastRoundId,commitment:jurorDraft.commitment,onRequestReveal:onRequestReveal});}(),(phase===DisputePhase.AppealRuling||phase===DisputePhase.ConfirmAppeal)&&React.createElement(DisputeAppeal,{disputeId:dispute.id,roundId:dispute.lastRoundId,onRequestAppeal:onRequestAppeal,confirm:phase===DisputePhase.ConfirmAppeal}),phase===DisputePhase.ExecuteRuling&&React.createElement(DisputeExecuteRuling,{disputeId:dispute.id,onExecuteRuling:onExecuteRuling}));}var _StyledDiv=_styled(\"div\").withConfig({displayName:\"DisputeActions___StyledDiv\",componentId:\"sc-24ucd8-0\"})([\"background:\",\";padding:\",\"px;display:flex;\"],function(p){return p._css;},function(p){return p._css2;});var _StyledDiv2=_styled(\"div\").withConfig({displayName:\"DisputeActions___StyledDiv2\",componentId:\"sc-24ucd8-1\"})([\"display:flex;align-items:center;margin:0 auto;\"]);var _StyledDiv3=_styled(\"div\").withConfig({displayName:\"DisputeActions___StyledDiv3\",componentId:\"sc-24ucd8-2\"})([\"margin-right:\",\"px;\"],function(p){return p._css3;});var _StyledImg=_styled(\"img\").withConfig({displayName:\"DisputeActions___StyledImg\",componentId:\"sc-24ucd8-3\"})([\"display:block;\"]);var _StyledDiv4=_styled(\"div\").withConfig({displayName:\"DisputeActions___StyledDiv4\",componentId:\"sc-24ucd8-4\"})([\"\",\"\"],function(p){return p._css4;});var _StyledSpan=_styled(\"span\").withConfig({displayName:\"DisputeActions___StyledSpan\",componentId:\"sc-24ucd8-5\"})([\"\",\" color:\",\";\"],function(p){return p._css5;},function(p){return p._css6;});function InformationSection(_ref2){var hasJurorVoted=_ref2.hasJurorVoted,jurorDraft=_ref2.jurorDraft,lastRound=_ref2.lastRound,phase=_ref2.phase,status=_ref2.status;var theme=useTheme();var _useInfoAttributes=useInfoAttributes({hasJurorVoted:hasJurorVoted,jurorDraft:jurorDraft,lastRound:lastRound,phase:phase,status:status}),title=_useInfoAttributes.title,paragraph=_useInfoAttributes.paragraph,background=_useInfoAttributes.background,icon=_useInfoAttributes.icon,hint=_useInfoAttributes.hint;if(!jurorDraft)return null;return React.createElement(_StyledDiv,{_css:background,_css2:3*GU},React.createElement(_StyledDiv2,null,React.createElement(_StyledDiv3,{_css3:1*GU},React.createElement(_StyledImg,{alt:\"\",src:icon,height:\"42\"})),React.createElement(\"div\",null,React.createElement(_StyledDiv4,{_css4:textStyle('body1')},title),React.createElement(_StyledSpan,{_css5:textStyle('body2'),_css6:theme.contentSecondary},paragraph,\" \",hint&&React.createElement(Help,{hint:hint})))));}// Helper function that returns main attributes for the YourVoteInfo component\n// TODO: Contemplate final round cases (when a juror has voted, the ANJ amount is pre-slashed)\nvar useInfoAttributes=function useInfoAttributes(_ref3){var hasJurorVoted=_ref3.hasJurorVoted,jurorDraft=_ref3.jurorDraft,lastRound=_ref3.lastRound,phase=_ref3.phase,status=_ref3.status;var theme=useTheme();var positiveBackground=theme.positive.alpha(0.1);var negativeBackground=theme.accent.alpha(0.2);return useMemo(function(){if(!jurorDraft)return{};// If the dispute is in the execute ruling phase it means that the final ruling can already be ensured.\n// If the dispute is closed it means that the final ruling was already ensured.\nvar finalRulingConfirmed=status===DisputeStatus.Closed||phase===DisputePhase.ExecuteRuling;// Note that we can assume that the evidence submission and drafting phases have already passed since we do an early return above\nvar votingPeriodEnded=phase!==DisputePhase.VotingPeriod&&phase!==DisputePhase.RevealVote;var voteLeaked=isvoteLeaked(jurorDraft.outcome);// If vote leaked or juror hasn't voted\nif(!hasJurorVoted||voteLeaked){return{title:voteLeaked?'Unfortunately, your vote has been leaked':'Your vote wasn’t cast on time.',paragraph:React.createElement(ANJDiscountedMessage,null),background:negativeBackground,icon:IconGavelRed,hintText:voteLeaked?'Vote leaked (complete)':null// TODO: Add hint for leaked vote\n};}// If juror voted and the voting (commit) period has ended\nif(hasJurorVoted&&votingPeriodEnded){// If the juror didn't revealed\nif(!jurorDraft.outcome){return{title:\"Your vote wasn't revealed on time\",paragraph:React.createElement(ANJDiscountedMessage,null),background:negativeBackground,icon:IconGavelRed};}// Juror has revealed\n// Check if has voted in consensus with the plurality for the last round\nvar hasVotedInConsensus=lastRound.vote&&jurorDraft.outcome===lastRound.vote.winningOutcome;// We must check if the penalties were already settled so we can tell the jurors\n// wether their ANJ locked balance has been discounted or they can claim rewards\n// Note that if the penalties for the round are settled it means that the dispute has already ended\nvar settledPenalties=lastRound.settledPenalties;var title=hasVotedInConsensus?'You have voted in consensus with the plurality':'You have not voted in consensus with the plurality';var background=hasVotedInConsensus?positiveBackground:negativeBackground;// If penalties settled then the locked ANJ has been redistributed\nif(settledPenalties){return{title:title,paragraph:hasVotedInConsensus?React.createElement(ANJRewardsMessage,null):React.createElement(ANJSlashedMessage,null),background:background,icon:hasVotedInConsensus?IconRewardsGreen:IconGavelRed};}// Includes the cases where penalties weren't settled or the last round hasn't ended\nreturn{title:title,paragraph:React.createElement(ANJLockedMessage,{finalRulingConfirmed:finalRulingConfirmed}),background:background,icon:hasVotedInConsensus?IconGavelOrange:IconGavelRed};}// Juror has voted and reveal period hasn't ended\nreturn{title:\"Your vote was cast \".concat(jurorDraft.outcome?'and revealed':'',\" successfully.\"),paragraph:React.createElement(VoteInfo,{commitmentDate:jurorDraft.commitmentDate,outcome:jurorDraft.outcome,revealDate:jurorDraft.revealDate}),background:theme.accent.alpha(0.05),icon:IconGavelOrange};},[hasJurorVoted,jurorDraft,lastRound.settledPenalties,lastRound.vote,negativeBackground,phase,positiveBackground,status,theme.accent]);};var ANJLockedMessage=function ANJLockedMessage(_ref4){var finalRulingConfirmed=_ref4.finalRulingConfirmed;return React.createElement(ANJMessage,{result:\"will remain locked until \".concat(finalRulingConfirmed?'penalties are settled':'the dispute has been resolved',\". \")});};var ANJDiscountedMessage=function ANJDiscountedMessage(){return React.createElement(ANJMessage,{result:\"will be discounted\"});};var ANJSlashedMessage=function ANJSlashedMessage(){return React.createElement(ANJMessage,{result:\"has been slashed and redistributed to other jurors\"});};var _StyledSpan2=_styled(\"span\").withConfig({displayName:\"DisputeActions___StyledSpan2\",componentId:\"sc-24ucd8-6\"})([\"color:\",\";\"],function(p){return p._css7;});var ANJMessage=function ANJMessage(_ref5){var result=_ref5.result;var theme=useTheme();return React.createElement(\"span\",null,\"Your\",' ',React.createElement(_StyledSpan2,{_css7:theme.help},\"ANJ locked balance\"),' ',result);};var _StyledSpan3=_styled(\"span\").withConfig({displayName:\"DisputeActions___StyledSpan3\",componentId:\"sc-24ucd8-7\"})([\"color:\",\";\"],function(p){return p._css8;});var ANJRewardsMessage=function ANJRewardsMessage(){var theme=useTheme();return React.createElement(\"span\",null,\"You can now claim your\",React.createElement(_StyledSpan3,{_css8:theme.help},' ',\"rewards\"),' ',\"in the dashboard.\");};var _StyledSpan4=_styled(\"span\").withConfig({displayName:\"DisputeActions___StyledSpan4\",componentId:\"sc-24ucd8-8\"})([\"text-transform:uppercase;color:\",\";\"],function(p){return p._css9;});var _StyledSpan5=_styled(\"span\").withConfig({displayName:\"DisputeActions___StyledSpan5\",componentId:\"sc-24ucd8-9\"})([\"color:\",\";\"],function(p){return p._css10;});var VoteInfo=function VoteInfo(_ref6){var commitmentDate=_ref6.commitmentDate,outcome=_ref6.outcome,revealDate=_ref6.revealDate;var theme=useTheme();var formattedDate=dateFormat(new Date(revealDate||commitmentDate),'standard');var outcomeDescription=useMemo(function(){if(outcome===OUTCOMES.Refused){return{text:'Refused to vote'};}return{prefix:'voted ',text:voteOptionToString(outcome)};},[outcome]);return React.createElement(\"span\",null,\"You \",outcomeDescription.prefix,React.createElement(_StyledSpan4,{_css9:theme.content},outcomeDescription.text),' ',\"on\",' ',React.createElement(_StyledSpan5,{_css10:theme.content},formattedDate));};export default DisputeActions;","map":{"version":3,"sources":["/Users/saleemfareed/oneds/court-dashboard/src/components/Disputes/DisputeActions.js"],"names":["React","useMemo","GU","Help","textStyle","useTheme","Phase","DisputePhase","Status","DisputeStatus","DisputeAppeal","DisputeAutoReveal","DisputeDraft","DisputeExecuteRuling","DisputeReveal","DisputeVoting","useWallet","getJurorDraft","hasJurorVoted","canJurorReveal","isvoteLeaked","voteOptionToString","OUTCOMES","dateFormat","getDisputeLastRound","DisputeActions","dispute","onAutoReveal","onDraft","onExecuteRuling","onRequestCommit","onRequestReveal","onRequestAppeal","phase","status","lastRound","wallet","Evidence","JuryDrafting","id","jurorDraft","account","isJurorDrafted","jurorHasVoted","VotingPeriod","draftTermId","maxAppealReached","commitment","lastRoundId","RevealVote","AppealRuling","ConfirmAppeal","ExecuteRuling","InformationSection","theme","useInfoAttributes","title","paragraph","background","icon","hint","contentSecondary","positiveBackground","positive","alpha","negativeBackground","accent","finalRulingConfirmed","Closed","votingPeriodEnded","voteLeaked","outcome","IconGavelRed","hintText","hasVotedInConsensus","vote","winningOutcome","settledPenalties","IconRewardsGreen","IconGavelOrange","commitmentDate","revealDate","ANJLockedMessage","ANJDiscountedMessage","ANJSlashedMessage","ANJMessage","result","help","ANJRewardsMessage","VoteInfo","formattedDate","Date","outcomeDescription","Refused","text","prefix","content"],"mappings":"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","sourcesContent":["import React, { useMemo } from 'react'\nimport { GU, Help, textStyle, useTheme } from '@aragon/ui'\nimport {\n  Phase as DisputePhase,\n  Status as DisputeStatus,\n} from '../../types/dispute-status-types'\nimport DisputeAppeal from './actions/DisputeAppeal'\nimport DisputeAutoReveal from './DisputeAutoReveal'\nimport DisputeDraft from './actions/DisputeDraft'\nimport DisputeExecuteRuling from './actions/DisputeExecuteRuling'\nimport DisputeReveal from './actions/DisputeReveal'\nimport DisputeVoting from './actions/DisputeVoting'\nimport { useWallet } from '../../providers/Wallet'\nimport {\n  getJurorDraft,\n  hasJurorVoted,\n  canJurorReveal,\n} from '../../utils/juror-draft-utils'\nimport {\n  isvoteLeaked,\n  voteOptionToString,\n  OUTCOMES,\n} from '../../utils/crvoting-utils'\nimport { dateFormat } from '../../utils/date-utils'\n\nimport IconGavelOrange from '../../assets/IconGavelOrange.svg'\nimport IconGavelRed from '../../assets/IconGavelRed.svg'\nimport { getDisputeLastRound } from '../../utils/dispute-utils'\nimport IconRewardsGreen from '../../assets/IconRewardsGreen.svg'\n\nfunction DisputeActions({\n  dispute,\n  onAutoReveal,\n  onDraft,\n  onExecuteRuling,\n  onRequestCommit,\n  onRequestReveal,\n  onRequestAppeal,\n}) {\n  const { phase, status } = dispute\n  const lastRound = getDisputeLastRound(dispute)\n\n  const wallet = useWallet()\n\n  if (phase === DisputePhase.Evidence) {\n    return null\n  }\n\n  if (phase === DisputePhase.JuryDrafting) {\n    return <DisputeDraft disputeId={dispute.id} onDraft={onDraft} />\n  }\n\n  const jurorDraft = getJurorDraft(lastRound, wallet.account) // TODO: Should we also show results for past rounds ?\n  const isJurorDrafted = !!jurorDraft\n\n  const jurorHasVoted = isJurorDrafted && hasJurorVoted(jurorDraft)\n\n  if (phase === DisputePhase.VotingPeriod && !jurorHasVoted) {\n    return (\n      <DisputeVoting\n        draftTermId={lastRound.draftTermId}\n        isFinalRound={dispute.maxAppealReached}\n        isJurorDrafted={isJurorDrafted}\n        onRequestCommit={onRequestCommit}\n      />\n    )\n  }\n\n  return (\n    <React.Fragment>\n      <InformationSection\n        phase={phase}\n        status={status}\n        jurorDraft={jurorDraft}\n        hasJurorVoted={jurorHasVoted}\n        lastRound={lastRound}\n      />\n      {(() => {\n        // If connected account not drafted for current dispute\n        if (!isJurorDrafted) return null\n\n        // If juror has already voted\n        if (phase === DisputePhase.VotingPeriod)\n          return (\n            <DisputeAutoReveal\n              disputeId={dispute.id}\n              commitment={jurorDraft.commitment}\n              onAutoReveal={onAutoReveal}\n              roundId={dispute.lastRoundId}\n            />\n          )\n\n        // If we are past the voting period && juror hasn't voted\n        if (!jurorHasVoted) return null\n\n        // If reveal period has already pass\n        if (phase !== DisputePhase.RevealVote) return null\n\n        // If juror cannot reveal (has already revealed || voted leaked)\n        if (!canJurorReveal(jurorDraft)) return null\n\n        return (\n          <DisputeReveal\n            disputeId={dispute.id}\n            roundId={dispute.lastRoundId}\n            commitment={jurorDraft.commitment}\n            onRequestReveal={onRequestReveal}\n          />\n        )\n      })()}\n\n      {(phase === DisputePhase.AppealRuling ||\n        phase === DisputePhase.ConfirmAppeal) && (\n        <DisputeAppeal\n          disputeId={dispute.id}\n          roundId={dispute.lastRoundId}\n          onRequestAppeal={onRequestAppeal}\n          confirm={phase === DisputePhase.ConfirmAppeal}\n        />\n      )}\n      {phase === DisputePhase.ExecuteRuling && (\n        <DisputeExecuteRuling\n          disputeId={dispute.id}\n          onExecuteRuling={onExecuteRuling}\n        />\n      )}\n    </React.Fragment>\n  )\n}\n\nfunction InformationSection({\n  hasJurorVoted,\n  jurorDraft,\n  lastRound,\n  phase,\n  status,\n}) {\n  const theme = useTheme()\n\n  const { title, paragraph, background, icon, hint } = useInfoAttributes({\n    hasJurorVoted,\n    jurorDraft,\n    lastRound,\n    phase,\n    status,\n  })\n\n  if (!jurorDraft) return null\n\n  return (\n    <div\n      css={`\n        background: ${background};\n        padding: ${3 * GU}px;\n        display: flex;\n      `}\n    >\n      <div\n        css={`\n          display: flex;\n          align-items: center;\n          margin: 0 auto;\n        `}\n      >\n        <div\n          css={`\n            margin-right: ${1 * GU}px;\n          `}\n        >\n          <img\n            alt=\"\"\n            src={icon}\n            height=\"42\"\n            css={`\n              display: block;\n            `}\n          />\n        </div>\n        <div>\n          <div\n            css={`\n              ${textStyle('body1')}\n            `}\n          >\n            {title}\n          </div>\n          <span\n            css={`\n              ${textStyle('body2')}\n              color: ${theme.contentSecondary};\n            `}\n          >\n            {paragraph} {hint && <Help hint={hint} />}\n          </span>\n        </div>\n      </div>\n    </div>\n  )\n}\n\n// Helper function that returns main attributes for the YourVoteInfo component\n// TODO: Contemplate final round cases (when a juror has voted, the ANJ amount is pre-slashed)\nconst useInfoAttributes = ({\n  hasJurorVoted,\n  jurorDraft,\n  lastRound,\n  phase,\n  status,\n}) => {\n  const theme = useTheme()\n  const positiveBackground = theme.positive.alpha(0.1)\n  const negativeBackground = theme.accent.alpha(0.2)\n\n  return useMemo(() => {\n    if (!jurorDraft) return {}\n\n    // If the dispute is in the execute ruling phase it means that the final ruling can already be ensured.\n    // If the dispute is closed it means that the final ruling was already ensured.\n    const finalRulingConfirmed =\n      status === DisputeStatus.Closed || phase === DisputePhase.ExecuteRuling\n\n    // Note that we can assume that the evidence submission and drafting phases have already passed since we do an early return above\n    const votingPeriodEnded =\n      phase !== DisputePhase.VotingPeriod && phase !== DisputePhase.RevealVote\n\n    const voteLeaked = isvoteLeaked(jurorDraft.outcome)\n\n    // If vote leaked or juror hasn't voted\n    if (!hasJurorVoted || voteLeaked) {\n      return {\n        title: voteLeaked\n          ? 'Unfortunately, your vote has been leaked'\n          : 'Your vote wasn’t cast on time.',\n        paragraph: <ANJDiscountedMessage />,\n        background: negativeBackground,\n        icon: IconGavelRed,\n        hintText: voteLeaked ? 'Vote leaked (complete)' : null, // TODO: Add hint for leaked vote\n      }\n    }\n\n    // If juror voted and the voting (commit) period has ended\n    if (hasJurorVoted && votingPeriodEnded) {\n      // If the juror didn't revealed\n      if (!jurorDraft.outcome) {\n        return {\n          title: \"Your vote wasn't revealed on time\",\n          paragraph: <ANJDiscountedMessage />,\n          background: negativeBackground,\n          icon: IconGavelRed,\n        }\n      }\n\n      // Juror has revealed\n      // Check if has voted in consensus with the plurality for the last round\n      const hasVotedInConsensus =\n        lastRound.vote && jurorDraft.outcome === lastRound.vote.winningOutcome\n\n      // We must check if the penalties were already settled so we can tell the jurors\n      // wether their ANJ locked balance has been discounted or they can claim rewards\n      // Note that if the penalties for the round are settled it means that the dispute has already ended\n      const settledPenalties = lastRound.settledPenalties\n\n      const title = hasVotedInConsensus\n        ? 'You have voted in consensus with the plurality'\n        : 'You have not voted in consensus with the plurality'\n      const background = hasVotedInConsensus\n        ? positiveBackground\n        : negativeBackground\n\n      // If penalties settled then the locked ANJ has been redistributed\n      if (settledPenalties) {\n        return {\n          title,\n          paragraph: hasVotedInConsensus ? (\n            <ANJRewardsMessage />\n          ) : (\n            <ANJSlashedMessage />\n          ),\n          background,\n          icon: hasVotedInConsensus ? IconRewardsGreen : IconGavelRed,\n        }\n      }\n\n      // Includes the cases where penalties weren't settled or the last round hasn't ended\n      return {\n        title,\n        paragraph: (\n          <ANJLockedMessage finalRulingConfirmed={finalRulingConfirmed} />\n        ),\n        background,\n        icon: hasVotedInConsensus ? IconGavelOrange : IconGavelRed,\n      }\n    }\n\n    // Juror has voted and reveal period hasn't ended\n    return {\n      title: `Your vote was cast ${\n        jurorDraft.outcome ? 'and revealed' : ''\n      } successfully.`,\n      paragraph: (\n        <VoteInfo\n          commitmentDate={jurorDraft.commitmentDate}\n          outcome={jurorDraft.outcome}\n          revealDate={jurorDraft.revealDate}\n        />\n      ),\n      background: theme.accent.alpha(0.05),\n      icon: IconGavelOrange,\n    }\n  }, [\n    hasJurorVoted,\n    jurorDraft,\n    lastRound.settledPenalties,\n    lastRound.vote,\n    negativeBackground,\n    phase,\n    positiveBackground,\n    status,\n    theme.accent,\n  ])\n}\n\nconst ANJLockedMessage = ({ finalRulingConfirmed }) => {\n  return (\n    <ANJMessage\n      result={`will remain locked until ${\n        finalRulingConfirmed\n          ? 'penalties are settled'\n          : 'the dispute has been resolved'\n      }. `}\n    />\n  )\n}\n\nconst ANJDiscountedMessage = () => {\n  return <ANJMessage result=\"will be discounted\" />\n}\n\nconst ANJSlashedMessage = () => {\n  return (\n    <ANJMessage result=\"has been slashed and redistributed to other jurors\" />\n  )\n}\n\nconst ANJMessage = ({ result }) => {\n  const theme = useTheme()\n\n  return (\n    <span>\n      Your{' '}\n      <span\n        css={`\n          color: ${theme.help};\n        `}\n      >\n        ANJ locked balance\n      </span>{' '}\n      {result}\n    </span>\n  )\n}\n\nconst ANJRewardsMessage = () => {\n  const theme = useTheme()\n\n  return (\n    <span>\n      You can now claim your\n      <span\n        css={`\n          color: ${theme.help};\n        `}\n      >\n        {' '}\n        rewards\n      </span>{' '}\n      in the dashboard.\n    </span>\n  )\n}\n\nconst VoteInfo = ({ commitmentDate, outcome, revealDate }) => {\n  const theme = useTheme()\n\n  const formattedDate = dateFormat(\n    new Date(revealDate || commitmentDate),\n    'standard'\n  )\n\n  const outcomeDescription = useMemo(() => {\n    if (outcome === OUTCOMES.Refused) {\n      return { text: 'Refused to vote' }\n    }\n\n    return { prefix: 'voted ', text: voteOptionToString(outcome) }\n  }, [outcome])\n\n  return (\n    <span>\n      You {outcomeDescription.prefix}\n      <span\n        css={`\n          text-transform: uppercase;\n          color: ${theme.content};\n        `}\n      >\n        {outcomeDescription.text}\n      </span>{' '}\n      on{' '}\n      <span\n        css={`\n          color: ${theme.content};\n        `}\n      >\n        {formattedDate}\n      </span>\n    </span>\n  )\n}\n\nexport default DisputeActions\n"]},"metadata":{},"sourceType":"module"}