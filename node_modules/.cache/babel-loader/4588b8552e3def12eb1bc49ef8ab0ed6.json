{"ast":null,"code":"import _regeneratorRuntime from\"/Users/saleemfareed/oneds/court-dashboard/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/saleemfareed/oneds/court-dashboard/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/saleemfareed/oneds/court-dashboard/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _taggedTemplateLiteral from\"/Users/saleemfareed/oneds/court-dashboard/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";function _templateObject2(){var data=_taggedTemplateLiteral([\"\\n  query {\\n    pair(id: \\\"\",\"\\\") {\\n      token0Price\\n    }\\n  }\\n\"]);_templateObject2=function _templateObject2(){return data;};return data;}function _templateObject(){var data=_taggedTemplateLiteral([\"\\n  query {\\n    pair(id: \\\"\",\"\\\") {\\n      token0Price\\n    }\\n  }\\n\"]);_templateObject=function _templateObject(){return data;};return data;}import{useEffect,useState}from'react';import{captureException}from'@sentry/browser';import gql from'graphql-tag';import{Client}from'urql';var RETRY_EVERY=3000;var UNISWAP_URL='https://api.thegraph.com/subgraphs/name/lutter/uniswap-v2';var ETH_ANJ_PAIR='0x0ffc70be6e2d841e109653ddb3034961591679d6';var DAI_ETH_PAIR='0xa478c2975ab1ea89e8196811f51a7b7ade33eb11';var graphqlClient=new Client({url:UNISWAP_URL});var ANJ_PRICE_QUERY=gql(_templateObject(),ETH_ANJ_PAIR);var ETH_PRICE_QUERY=gql(_templateObject2(),DAI_ETH_PAIR);export function useUniswapAnjPrice(){var _useState=useState(0),_useState2=_slicedToArray(_useState,2),anjPrice=_useState2[0],setAnjPrice=_useState2[1];useEffect(function(){var cancelled=false;var retryTimer;function fetchPrice(){return _fetchPrice.apply(this,arguments);}function _fetchPrice(){_fetchPrice=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _ref,_ref2,anjResults,ethResults,anjPair,ethPair,anjToEthPrice,ethToDaiPrice,_anjPrice;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return Promise.all([graphqlClient.query(ANJ_PRICE_QUERY).toPromise(),graphqlClient.query(ETH_PRICE_QUERY).toPromise()]);case 3:_ref=_context.sent;_ref2=_slicedToArray(_ref,2);anjResults=_ref2[0];ethResults=_ref2[1];anjPair=anjResults.data.pair;ethPair=ethResults.data.pair;anjToEthPrice=anjPair.token0Price;ethToDaiPrice=ethPair.token0Price;_anjPrice=Number(anjToEthPrice)*Number(ethToDaiPrice);if(!cancelled){setAnjPrice(_anjPrice);}_context.next=19;break;case 15:_context.prev=15;_context.t0=_context[\"catch\"](0);captureException(_context.t0);retryTimer=setTimeout(fetchPrice,RETRY_EVERY);case 19:case\"end\":return _context.stop();}}},_callee,null,[[0,15]]);}));return _fetchPrice.apply(this,arguments);}fetchPrice();return function(){cancelled=true;clearTimeout(retryTimer);};},[]);return anjPrice;}","map":{"version":3,"sources":["/Users/saleemfareed/oneds/court-dashboard/src/hooks/useUniswapAnjPrice.js"],"names":["useEffect","useState","captureException","gql","Client","RETRY_EVERY","UNISWAP_URL","ETH_ANJ_PAIR","DAI_ETH_PAIR","graphqlClient","url","ANJ_PRICE_QUERY","ETH_PRICE_QUERY","useUniswapAnjPrice","anjPrice","setAnjPrice","cancelled","retryTimer","fetchPrice","Promise","all","query","toPromise","anjResults","ethResults","anjPair","data","pair","ethPair","anjToEthPrice","token0Price","ethToDaiPrice","Number","setTimeout","clearTimeout"],"mappings":"w5BAAA,OAASA,SAAT,CAAoBC,QAApB,KAAoC,OAApC,CACA,OAASC,gBAAT,KAAiC,iBAAjC,CAEA,MAAOC,CAAAA,GAAP,KAAgB,aAAhB,CACA,OAASC,MAAT,KAAuB,MAAvB,CAEA,GAAMC,CAAAA,WAAW,CAAG,IAApB,CAEA,GAAMC,CAAAA,WAAW,CAAG,2DAApB,CACA,GAAMC,CAAAA,YAAY,CAAG,4CAArB,CACA,GAAMC,CAAAA,YAAY,CAAG,4CAArB,CAEA,GAAMC,CAAAA,aAAa,CAAG,GAAIL,CAAAA,MAAJ,CAAW,CAAEM,GAAG,CAAEJ,WAAP,CAAX,CAAtB,CAEA,GAAMK,CAAAA,eAAe,CAAGR,GAAH,mBAELI,YAFK,CAArB,CAOA,GAAMK,CAAAA,eAAe,CAAGT,GAAH,oBAELK,YAFK,CAArB,CAQA,MAAO,SAASK,CAAAA,kBAAT,EAA8B,eACHZ,QAAQ,CAAC,CAAD,CADL,wCAC5Ba,QAD4B,eAClBC,WADkB,eAGnCf,SAAS,CAAC,UAAM,CACd,GAAIgB,CAAAA,SAAS,CAAG,KAAhB,CACA,GAAIC,CAAAA,UAAJ,CAFc,QAGCC,CAAAA,UAHD,wIAGd,oQAE2CC,CAAAA,OAAO,CAACC,GAAR,CAAY,CACjDX,aAAa,CAACY,KAAd,CAAoBV,eAApB,EAAqCW,SAArC,EADiD,CAEjDb,aAAa,CAACY,KAAd,CAAoBT,eAApB,EAAqCU,SAArC,EAFiD,CAAZ,CAF3C,wDAEWC,UAFX,UAEuBC,UAFvB,UAOkBC,OAPlB,CAO8BF,UAAU,CAACG,IAPzC,CAOYC,IAPZ,CAQkBC,OARlB,CAQ8BJ,UAAU,CAACE,IARzC,CAQYC,IARZ,CASUE,aATV,CAS0BJ,OAAO,CAACK,WATlC,CAUUC,aAVV,CAU0BH,OAAO,CAACE,WAVlC,CAWUhB,SAXV,CAWqBkB,MAAM,CAACH,aAAD,CAAN,CAAwBG,MAAM,CAACD,aAAD,CAXnD,CAaI,GAAI,CAACf,SAAL,CAAgB,CACdD,WAAW,CAACD,SAAD,CAAX,CACD,CAfL,iFAiBIZ,gBAAgB,aAAhB,CACAe,UAAU,CAAGgB,UAAU,CAACf,UAAD,CAAab,WAAb,CAAvB,CAlBJ,qEAHc,6CAyBda,UAAU,GAEV,MAAO,WAAM,CACXF,SAAS,CAAG,IAAZ,CACAkB,YAAY,CAACjB,UAAD,CAAZ,CACD,CAHD,CAID,CA/BQ,CA+BN,EA/BM,CAAT,CAiCA,MAAOH,CAAAA,QAAP,CACD","sourcesContent":["import { useEffect, useState } from 'react'\nimport { captureException } from '@sentry/browser'\n\nimport gql from 'graphql-tag'\nimport { Client } from 'urql'\n\nconst RETRY_EVERY = 3000\n\nconst UNISWAP_URL = 'https://api.thegraph.com/subgraphs/name/lutter/uniswap-v2'\nconst ETH_ANJ_PAIR = '0x0ffc70be6e2d841e109653ddb3034961591679d6'\nconst DAI_ETH_PAIR = '0xa478c2975ab1ea89e8196811f51a7b7ade33eb11'\n\nconst graphqlClient = new Client({ url: UNISWAP_URL })\n\nconst ANJ_PRICE_QUERY = gql`\n  query {\n    pair(id: \"${ETH_ANJ_PAIR}\") {\n      token0Price\n    }\n  }\n`\nconst ETH_PRICE_QUERY = gql`\n  query {\n    pair(id: \"${DAI_ETH_PAIR}\") {\n      token0Price\n    }\n  }\n`\n\nexport function useUniswapAnjPrice() {\n  const [anjPrice, setAnjPrice] = useState(0)\n\n  useEffect(() => {\n    let cancelled = false\n    let retryTimer\n    async function fetchPrice() {\n      try {\n        const [anjResults, ethResults] = await Promise.all([\n          graphqlClient.query(ANJ_PRICE_QUERY).toPromise(),\n          graphqlClient.query(ETH_PRICE_QUERY).toPromise(),\n        ])\n\n        const { pair: anjPair } = anjResults.data\n        const { pair: ethPair } = ethResults.data\n        const anjToEthPrice = anjPair.token0Price\n        const ethToDaiPrice = ethPair.token0Price\n        const anjPrice = Number(anjToEthPrice) * Number(ethToDaiPrice)\n\n        if (!cancelled) {\n          setAnjPrice(anjPrice)\n        }\n      } catch (err) {\n        captureException(err)\n        retryTimer = setTimeout(fetchPrice, RETRY_EVERY)\n      }\n    }\n\n    fetchPrice()\n\n    return () => {\n      cancelled = true\n      clearTimeout(retryTimer)\n    }\n  }, [])\n\n  return anjPrice\n}\n"]},"metadata":{},"sourceType":"module"}